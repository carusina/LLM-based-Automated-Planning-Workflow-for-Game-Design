<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게임 기획을 위한 LLM기반 기획 자동화</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #343a40;
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 15px;
        }
        .btn-primary {
            background-color: #4361ee;
            border-color: #4361ee;
        }
        .btn-primary:hover {
            background-color: #3a56d4;
            border-color: #3a56d4;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .tab-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 15px 15px;
            border: 1px solid #dee2e6;
            border-top: none;
        }
        .nav-tabs .nav-link.active {
            font-weight: bold;
            color: #4361ee;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .form-label {
            font-weight: 600;
        }
        .loading-spinner {
            display: none;
        }
        .result-container {
            display: none;
            margin-top: 30px;
        }
        #resultTabs .nav-link {
            font-size: 0.9rem;
        }
        .result-section {
            margin-bottom: 20px;
        }
        .section-title {
            font-weight: 600;
            border-bottom: 2px solid #4361ee;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="text-center mb-5">
            <h1 class="display-4">게임 기획을 위한 LLM기반 기획 자동화</h1>
            <p class="lead">대규모 언어 모델(LLM)을 활용하여 창의적이고 구체적인 게임 기획서를 자동으로 생성합니다.</p>
        </header>

        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h3>게임 기획 생성기</h3>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab" aria-controls="basic" aria-selected="true">기본 정보</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab" aria-controls="advanced" aria-selected="false">심화 정보</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="competitive-tab" data-bs-toggle="tab" data-bs-target="#competitive" type="button" role="tab" aria-controls="competitive" aria-selected="false">경쟁 분석</button>
                            </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                                <form id="gameDesignForm">
                                    <div class="form-group">
                                        <label for="gameConceptInput" class="form-label">게임 컨셉 <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="gameConceptInput" rows="3" placeholder="게임에 대한 기본적인 아이디어나 컨셉을 입력하세요." required></textarea>
                                        <div class="form-text">예: "우주 탐험을 테마로 한 로그라이크 생존 게임" 또는 "중세 판타지 세계관의 농장 경영 RPG"</div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="genreInput" class="form-label">장르</label>
                                                <select class="form-select" id="genreInput">
                                                    <option value="">장르 선택...</option>
                                                    <option value="액션">액션</option>
                                                    <option value="어드벤처">어드벤처</option>
                                                    <option value="RPG">RPG</option>
                                                    <option value="전략">전략</option>
                                                    <option value="시뮬레이션">시뮬레이션</option>
                                                    <option value="퍼즐">퍼즐</option>
                                                    <option value="스포츠">스포츠</option>
                                                    <option value="레이싱">레이싱</option>
                                                    <option value="FPS">FPS</option>
                                                    <option value="플랫포머">플랫포머</option>
                                                    <option value="로그라이크">로그라이크</option>
                                                    <option value="리듬">리듬</option>
                                                    <option value="카드">카드</option>
                                                    <option value="배틀로얄">배틀로얄</option>
                                                    <option value="메트로배니아">메트로배니아</option>
                                                    <option value="샌드박스">샌드박스</option>
                                                    <option value="기타">기타 (직접 입력)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="platformInput" class="form-label">플랫폼</label>
                                                <select class="form-select" id="platformInput">
                                                    <option value="PC">PC</option>
                                                    <option value="모바일">모바일</option>
                                                    <option value="콘솔">콘솔</option>
                                                    <option value="멀티플랫폼">멀티플랫폼</option>
                                                    <option value="VR">VR</option>
                                                    <option value="AR">AR</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="targetAudienceInput" class="form-label">타겟 사용자층</label>
                                                <select class="form-select" id="targetAudienceInput">
                                                    <option value="일반 게이머">일반 게이머</option>
                                                    <option value="캐주얼 게이머">캐주얼 게이머</option>
                                                    <option value="하드코어 게이머">하드코어 게이머</option>
                                                    <option value="어린이">어린이</option>
                                                    <option value="청소년">청소년</option>
                                                    <option value="성인">성인</option>
                                                    <option value="가족">가족</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                                <form id="advancedForm">
                                    <div class="form-group">
                                        <label for="gameplayMechanicsInput" class="form-label">게임플레이 메커니즘</label>
                                        <textarea class="form-control" id="gameplayMechanicsInput" rows="2" placeholder="주요 게임플레이 메커니즘이나 규칙을 입력하세요."></textarea>
                                        <div class="form-text">여러 메커니즘은 쉼표로 구분하세요. 예: "턴제 전투, 자원 관리, 레벨 업 시스템"</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="artStyleInput" class="form-label">아트 스타일</label>
                                        <input type="text" class="form-control" id="artStyleInput" placeholder="원하는 아트 스타일이나 시각적 방향성을 입력하세요.">
                                        <div class="form-text">예: "픽셀 아트", "저채도 수채화", "사실적 3D", "스타일라이즈드 만화"</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="storyElementsInput" class="form-label">스토리 요소</label>
                                        <textarea class="form-control" id="storyElementsInput" rows="2" placeholder="스토리나 내러티브에 관한 아이디어를 입력하세요."></textarea>
                                        <div class="form-text">세계관, 캐릭터, 또는 스토리 아크에 대한 아이디어를 자유롭게 작성하세요.</div>
                                    </div>
                                </form>
                                <!-- 스토리라인 옵션 추가 -->
                                <div class="form-group">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="generateStorylineCheckbox">
                                        <label class="form-check-label" for="generateStorylineCheckbox">
                                            스토리라인 함께 생성하기
                                        </label>
                                        <div class="form-text">내러티브 컨셉을 바탕으로 상세한 스토리라인도 함께 생성합니다.</div>
                                    </div>
                                </div>

                                <div id="storylineOptions" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="numChaptersInput" class="form-label">챕터 수</label>
                                                <select class="form-select" id="numChaptersInput">
                                                    <option value="3">3 챕터</option>
                                                    <option value="5" selected>5 챕터</option>
                                                    <option value="7">7 챕터</option>
                                                    <option value="9">9 챕터</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="numBranchesInput" class="form-label">스토리 분기 수</label>
                                                <select class="form-select" id="numBranchesInput">
                                                    <option value="2">2 분기</option>
                                                    <option value="3" selected>3 분기</option>
                                                    <option value="4">4 분기</option>
                                                    <option value="5">5 분기</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="competitive" role="tabpanel" aria-labelledby="competitive-tab">
                                <form id="competitiveForm">
                                    <div class="form-group">
                                        <label class="form-label">경쟁 게임 분석</label>
                                        <p class="small text-muted">참고하거나 분석하고 싶은 경쟁 게임을 입력하세요. 최대 2개까지 가능합니다.</p>
                                        
                                        <div class="mb-3">
                                            <label for="competitor1Input" class="form-label">경쟁 게임 1</label>
                                            <input type="text" class="form-control" id="competitor1Input" placeholder="게임 이름">
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="competitor2Input" class="form-label">경쟁 게임 2</label>
                                            <input type="text" class="form-control" id="competitor2Input" placeholder="게임 이름">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button id="generateBtn" class="btn btn-primary btn-lg">
                                <span class="normal-text">게임 기획서 생성</span>
                                <div class="loading-spinner spinner-border spinner-border-sm text-light" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 결과 표시 영역 -->
                <div id="resultContainer" class="result-container">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3 id="gameTitle">게임 기획서</h3>
                            <div>
                                <button id="downloadBtn" class="btn btn-outline-light">
                                    <i class="bi bi-download"></i> 다운로드
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="resultTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">개요</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="gameplay-tab" data-bs-toggle="tab" data-bs-target="#gameplay" type="button" role="tab" aria-controls="gameplay" aria-selected="false">게임플레이</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="narrative-tab" data-bs-toggle="tab" data-bs-target="#narrative" type="button" role="tab" aria-controls="narrative" aria-selected="false">내러티브</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="art-tab" data-bs-toggle="tab" data-bs-target="#art" type="button" role="tab" aria-controls="art" aria-selected="false">아트 디렉션</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="tech-tab" data-bs-toggle="tab" data-bs-target="#tech" type="button" role="tab" aria-controls="tech" aria-selected="false">기술 사양</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="monetization-tab" data-bs-toggle="tab" data-bs-target="#monetization" type="button" role="tab" aria-controls="monetization" aria-selected="false">수익화</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="roadmap-tab" data-bs-toggle="tab" data-bs-target="#roadmap" type="button" role="tab" aria-controls="roadmap" aria-selected="false">로드맵</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="storyline-tab" data-bs-toggle="tab" data-bs-target="#storyline" type="button" role="tab" aria-controls="storyline" aria-selected="false">스토리라인</button>
                                </li>
                            </ul>
                            <div class="tab-content" id="resultTabsContent">
                                <!-- 개요 탭 -->
                                <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                                    <div class="result-section">
                                        <h4 class="section-title">고수준 컨셉</h4>
                                        <p id="highConcept"></p>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="result-section">
                                                <h4 class="section-title">타겟 사용자층</h4>
                                                <p id="targetAudience"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">확장된 컨셉</h4>
                                        <p id="extendedConcept"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">차별화 포인트</h4>
                                        <ul id="uniqueSellingPoints"></ul>
                                    </div>
                                </div>
                                
                                <!-- 게임플레이 탭 -->
                                <div class="tab-pane fade" id="gameplay" role="tabpanel" aria-labelledby="gameplay-tab">
                                    <div class="result-section">
                                        <h4 class="section-title">핵심 게임플레이 루프</h4>
                                        <p id="coreGameplayLoop"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">플레이어 액션</h4>
                                        <ul id="playerActions"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">진행 시스템</h4>
                                        <p id="progressionSystem"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">도전 유형</h4>
                                        <ul id="challengeTypes"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">보상 시스템</h4>
                                        <ul id="rewardSystems"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">게임 모드</h4>
                                        <ul id="gameModes"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">독특한 메커니즘</h4>
                                        <ul id="uniqueMechanics"></ul>
                                    </div>
                                </div>
                                
                                <!-- 내러티브 탭 -->
                                <div class="tab-pane fade" id="narrative" role="tabpanel" aria-labelledby="narrative-tab">
                                    <div class="result-section">
                                        <h4 class="section-title">세계관</h4>
                                        <p id="setting"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">배경 스토리</h4>
                                        <p id="backgroundLore"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">주요 스토리라인</h4>
                                        <p id="mainPlot"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">주요 테마</h4>
                                        <ul id="themes"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">캐릭터</h4>
                                        <div id="characters"></div>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">내러티브 장치</h4>
                                        <ul id="narrativeDevices"></ul>
                                    </div>
                                </div>
                                
                                <!-- 아트 디렉션 탭 -->
                                <div class="tab-pane fade" id="art" role="tabpanel" aria-labelledby="art-tab">
                                    <div class="result-section">
                                        <h4 class="section-title">시각적 스타일</h4>
                                        <p id="visualStyle"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">색상 팔레트</h4>
                                        <p id="colorPalette"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">캐릭터 디자인</h4>
                                        <p id="characterDesign"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">환경 디자인</h4>
                                        <p id="environmentDesign"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">UI 디자인</h4>
                                        <p id="uiDesign"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">애니메이션 스타일</h4>
                                        <p id="animationStyle"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">사운드 디자인</h4>
                                        <p id="soundDesign"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">음악 방향</h4>
                                        <p id="musicDirection"></p>
                                    </div>
                                </div>
                                
                                <!-- 기술 사양 탭 -->
                                <div class="tab-pane fade" id="tech" role="tabpanel" aria-labelledby="tech-tab">
                                    <div class="result-section">
                                        <h4 class="section-title">타겟 플랫폼</h4>
                                        <ul id="targetPlatforms"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">게임 엔진</h4>
                                        <p id="engine"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">핵심 기술</h4>
                                        <ul id="keyTechnologies"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">개발 도전 과제</h4>
                                        <ul id="developmentChallenges"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">에셋 요구사항</h4>
                                        <p id="assetRequirements"></p>
                                    </div>
                                </div>
                                
                                <!-- 수익화 탭 -->
                                <div class="tab-pane fade" id="monetization" role="tabpanel" aria-labelledby="monetization-tab">
                                    <div class="result-section">
                                        <h4 class="section-title">수익화 모델</h4>
                                        <p id="monetizationModel"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">가격 책정</h4>
                                        <p id="pricePoint"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">인앱 구매</h4>
                                        <p id="inAppPurchases"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">DLC/확장팩</h4>
                                        <p id="dlcExpansion"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">플레이어 유지 전략</h4>
                                        <ul id="playerRetentionStrategies"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">시장 분석</h4>
                                        <p id="marketAnalysis"></p>
                                    </div>
                                </div>
                                
                                <!-- 로드맵 탭 -->
                                <div class="tab-pane fade" id="roadmap" role="tabpanel" aria-labelledby="roadmap-tab">
                                    <div class="result-section">
                                        <h4 class="section-title">개발 타임라인</h4>
                                        <div id="developmentTimeline"></div>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">팀 구성</h4>
                                        <div>
                                            <h5>핵심 팀</h5>
                                            <ul id="coreTeam"></ul>
                                            <h5>확장 팀</h5>
                                            <ul id="expandedTeam"></ul>
                                        </div>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">예산 추정</h4>
                                        <p id="budgetEstimate"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">리스크 평가</h4>
                                        <ul id="riskAssessment"></ul>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">테스트 계획</h4>
                                        <p id="testingPlan"></p>
                                    </div>
                                    <div class="result-section">
                                        <h4 class="section-title">성공 지표</h4>
                                        <ul id="successMetrics"></ul>
                                    </div>
                                </div>
                                
                                <!-- 스토리라인 탭 -->
                                <div class="tab-pane fade" id="storyline" role="tabpanel" aria-labelledby="storyline-tab">
                                    <div id="storylineContent">
                                        <div class="alert alert-info">
                                            스토리라인을 생성하지 않았거나 아직 로딩 중입니다.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 다운로드 형식 선택 모달 -->
    <div class="modal fade" id="downloadModal" tabindex="-1" aria-labelledby="downloadModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="downloadModalLabel">다운로드 형식 선택</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="downloadFormat" id="markdownFormat" value="markdown" checked>
                        <label class="form-check-label" for="markdownFormat">
                            마크다운 (.md)
                        </label>
                        <small class="d-block text-muted">가볍고 편집하기 쉬운 텍스트 형식</small>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" name="downloadFormat" id="docxFormat" value="docx">
                        <label class="form-check-label" for="docxFormat">
                            워드 문서 (.docx)
                        </label>
                        <small class="d-block text-muted">Microsoft Word에서 열 수 있는 형식</small>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="downloadFormat" id="pdfFormat" value="pdf">
                        <label class="form-check-label" for="pdfFormat">
                            PDF (.pdf)
                        </label>
                        <small class="d-block text-muted">모든 환경에서 동일하게 표시되는 형식</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" id="confirmDownloadBtn">다운로드</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
        // DOM 요소
        const generateBtn = document.getElementById('generateBtn');
        const resultContainer = document.getElementById('resultContainer');
        const downloadBtn = document.getElementById('downloadBtn');
        const confirmDownloadBtn = document.getElementById('confirmDownloadBtn');
        
        // 스토리라인 체크박스 이벤트 리스너
        const generateStorylineCheckbox = document.getElementById('generateStorylineCheckbox');
        const storylineOptions = document.getElementById('storylineOptions');
        
        if (generateStorylineCheckbox) {
            generateStorylineCheckbox.addEventListener('change', function() {
                storylineOptions.style.display = this.checked ? 'block' : 'none';
            });
        }
        
        // 게임 기획서 데이터를 저장할 전역 변수
        let gameDesignData = null;
        
        // 생성 버튼 클릭 이벤트
        generateBtn.addEventListener('click', function() {
            // 필수 입력 검증
            const gameConcept = document.getElementById('gameConceptInput').value.trim();
            if (!gameConcept) {
                alert('게임 컨셉은 필수입니다.');
                return;
            }
            
            // 로딩 상태 표시
            generateBtn.disabled = true;
            generateBtn.querySelector('.normal-text').style.display = 'none';
            generateBtn.querySelector('.loading-spinner').style.display = 'inline-block';
            
            // 입력 데이터 수집
            const genre = document.getElementById('genreInput').value;
            const platform = document.getElementById('platformInput').value;
            const targetAudience = document.getElementById('targetAudienceInput').value;
            const gameplayMechanics = document.getElementById('gameplayMechanicsInput').value.split(',').map(item => item.trim()).filter(item => item);
            const artStyle = document.getElementById('artStyleInput').value;
            const storyElements = document.getElementById('storyElementsInput').value;
            
            // 경쟁 게임 목록
            const competitiveAnalysis = [];
            const competitor1 = document.getElementById('competitor1Input').value.trim();
            const competitor2 = document.getElementById('competitor2Input').value.trim();
            
            if (competitor1) competitiveAnalysis.push(competitor1);
            if (competitor2) competitiveAnalysis.push(competitor2);
            
            // API 요청 데이터
            const requestData = {
                game_concept: gameConcept,
                genre: genre,
                platform: platform,
                target_audience: targetAudience,
                gameplay_mechanics: gameplayMechanics,
                art_style: artStyle,
                story_elements: storyElements ? { concept: storyElements } : {},
                competitive_analysis: competitiveAnalysis,
                // 스토리라인 생성 옵션 추가
                generate_storyline: document.getElementById('generateStorylineCheckbox') ? document.getElementById('generateStorylineCheckbox').checked : false,
                num_chapters: document.getElementById('numChaptersInput') ? parseInt(document.getElementById('numChaptersInput').value) : 5,
                num_branches: document.getElementById('numBranchesInput') ? parseInt(document.getElementById('numBranchesInput').value) : 3
            };
            
            // API 호출
            fetch('/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 결과 데이터 저장
                    gameDesignData = data.game_design;
                    
                    // 결과 표시
                    displayGameDesign(gameDesignData);
                    
                    // 결과 컨테이너 표시
                    resultContainer.style.display = 'block';
                    
                    // 결과로 스크롤
                    resultContainer.scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('오류가 발생했습니다: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('API 호출 중 오류가 발생했습니다.');
            })
            .finally(() => {
                // 로딩 상태 해제
                generateBtn.disabled = false;
                generateBtn.querySelector('.normal-text').style.display = 'inline-block';
                generateBtn.querySelector('.loading-spinner').style.display = 'none';
            });
        });
        
        // 다운로드 버튼 클릭 이벤트
        downloadBtn.addEventListener('click', function() {
            // 모달 표시
            const downloadModal = new bootstrap.Modal(document.getElementById('downloadModal'));
            downloadModal.show();
        });
        
        // 다운로드 확인 버튼 클릭 이벤트
        confirmDownloadBtn.addEventListener('click', function() {
            // 선택된 형식 가져오기
            const format = document.querySelector('input[name="downloadFormat"]:checked').value;
            
            // API 요청 데이터
            const requestData = {
                current_design: gameDesignData,
                format: format
            };
            
            // API 호출
            fetch('/download', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.blob())
            .then(blob => {
                // 파일 다운로드
                const fileName = `${gameDesignData.game_title.replace(/\s+/g, '_')}_게임기획서.${format}`;
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('파일 다운로드 중 오류가 발생했습니다.');
            })
            .finally(() => {
                // 모달 닫기
                bootstrap.Modal.getInstance(document.getElementById('downloadModal')).hide();
            });
        });
        
        // 게임 기획서 데이터 표시 함수
        function displayGameDesign(data) {
            // 제목 및 기본 정보
            document.getElementById('gameTitle').textContent = data.game_title;
            document.getElementById('highConcept').textContent = data.high_concept;
            document.getElementById('targetAudience').textContent = data.target_audience;
            
            // 컨셉 세부사항
            const conceptDetails = data.concept_details;
            document.getElementById('extendedConcept').textContent = conceptDetails.extended_concept;
            
            const uniqueSellingPointsList = document.getElementById('uniqueSellingPoints');
            uniqueSellingPointsList.innerHTML = '';
            conceptDetails.unique_selling_points.forEach(point => {
                const li = document.createElement('li');
                li.textContent = point;
                uniqueSellingPointsList.appendChild(li);
            });
            
            // 게임플레이
            const gameplay = data.gameplay;
            document.getElementById('coreGameplayLoop').textContent = gameplay.core_gameplay_loop;
            
            const playerActionsList = document.getElementById('playerActions');
            playerActionsList.innerHTML = '';
            gameplay.player_actions.forEach(action => {
                const li = document.createElement('li');
                li.textContent = action;
                playerActionsList.appendChild(li);
            });
            
            document.getElementById('progressionSystem').textContent = gameplay.progression_system;
            
            const challengeTypesList = document.getElementById('challengeTypes');
            challengeTypesList.innerHTML = '';
            gameplay.challenge_types.forEach(challenge => {
                const li = document.createElement('li');
                li.textContent = challenge;
                challengeTypesList.appendChild(li);
            });
            
            const rewardSystemsList = document.getElementById('rewardSystems');
            rewardSystemsList.innerHTML = '';
            gameplay.reward_systems.forEach(reward => {
                const li = document.createElement('li');
                li.textContent = reward;
                rewardSystemsList.appendChild(li);
            });
            
            const gameModesList = document.getElementById('gameModes');
            gameModesList.innerHTML = '';
            gameplay.game_modes.forEach(mode => {
                const li = document.createElement('li');
                li.textContent = mode;
                gameModesList.appendChild(li);
            });
            
            const uniqueMechanicsList = document.getElementById('uniqueMechanics');
            uniqueMechanicsList.innerHTML = '';
            gameplay.unique_mechanics.forEach(mechanic => {
                const li = document.createElement('li');
                li.textContent = mechanic;
                uniqueMechanicsList.appendChild(li);
            });
            
            // 내러티브
            const narrative = data.narrative;
            document.getElementById('setting').textContent = narrative.setting;
            document.getElementById('backgroundLore').textContent = narrative.background_lore;
            document.getElementById('mainPlot').textContent = narrative.main_plot;
            
            const themesList = document.getElementById('themes');
            themesList.innerHTML = '';
            narrative.themes.forEach(theme => {
                const li = document.createElement('li');
                li.textContent = theme;
                themesList.appendChild(li);
            });
            
            const charactersContainer = document.getElementById('characters');
            charactersContainer.innerHTML = '';
            narrative.characters.forEach(character => {
                const characterDiv = document.createElement('div');
                characterDiv.className = 'card mb-3';
                
                const characterHeader = document.createElement('div');
                characterHeader.className = 'card-header bg-secondary text-white';
                characterHeader.textContent = character.name;
                
                const characterBody = document.createElement('div');
                characterBody.className = 'card-body';
                
                const roleP = document.createElement('p');
                roleP.innerHTML = '<strong>역할:</strong> ' + character.role;
                
                const backgroundP = document.createElement('p');
                backgroundP.innerHTML = '<strong>배경:</strong> ' + character.background;
                
                const motivationP = document.createElement('p');
                motivationP.innerHTML = '<strong>동기:</strong> ' + character.motivation;
                
                const arcP = document.createElement('p');
                arcP.innerHTML = '<strong>캐릭터 아크:</strong> ' + character.arc;
                
                characterBody.appendChild(roleP);
                characterBody.appendChild(backgroundP);
                characterBody.appendChild(motivationP);
                characterBody.appendChild(arcP);
                
                characterDiv.appendChild(characterHeader);
                characterDiv.appendChild(characterBody);
                
                charactersContainer.appendChild(characterDiv);
            });
            
            const narrativeDevicesList = document.getElementById('narrativeDevices');
            narrativeDevicesList.innerHTML = '';
            narrative.narrative_devices.forEach(device => {
                const li = document.createElement('li');
                li.textContent = device;
                narrativeDevicesList.appendChild(li);
            });
            
            // 아트 디렉션
            const art = data.art_direction;
            document.getElementById('visualStyle').textContent = art.visual_style;
            document.getElementById('colorPalette').textContent = art.color_palette;
            document.getElementById('characterDesign').textContent = art.character_design;
            document.getElementById('environmentDesign').textContent = art.environment_design;
            document.getElementById('uiDesign').textContent = art.ui_design;
            document.getElementById('animationStyle').textContent = art.animation_style;
            document.getElementById('soundDesign').textContent = art.sound_design;
            document.getElementById('musicDirection').textContent = art.music_direction;
            
            // 기술 사양
            const tech = data.technical_specs;
            
            const targetPlatformsList = document.getElementById('targetPlatforms');
            targetPlatformsList.innerHTML = '';
            tech.target_platforms.forEach(platform => {
                const li = document.createElement('li');
                li.textContent = platform;
                targetPlatformsList.appendChild(li);
            });
            
            document.getElementById('engine').textContent = tech.engine;
            
            const keyTechnologiesList = document.getElementById('keyTechnologies');
            keyTechnologiesList.innerHTML = '';
            tech.key_technologies.forEach(technology => {
                const li = document.createElement('li');
                li.textContent = technology;
                keyTechnologiesList.appendChild(li);
            });
            
            const developmentChallengesList = document.getElementById('developmentChallenges');
            developmentChallengesList.innerHTML = '';
            tech.development_challenges.forEach(challenge => {
                const li = document.createElement('li');
                li.textContent = challenge;
                developmentChallengesList.appendChild(li);
            });
            
            document.getElementById('assetRequirements').textContent = tech.asset_requirements;
            
            // 수익화 계획
            const monetization = data.monetization;
            document.getElementById('monetizationModel').textContent = monetization.monetization_model;
            document.getElementById('pricePoint').textContent = monetization.price_point;
            document.getElementById('inAppPurchases').textContent = monetization.in_app_purchases;
            document.getElementById('dlcExpansion').textContent = monetization.dlc_expansion;
            
            const playerRetentionStrategiesList = document.getElementById('playerRetentionStrategies');
            playerRetentionStrategiesList.innerHTML = '';
            monetization.player_retention_strategies.forEach(strategy => {
                const li = document.createElement('li');
                li.textContent = strategy;
                playerRetentionStrategiesList.appendChild(li);
            });
            
            document.getElementById('marketAnalysis').textContent = monetization.market_analysis;
            
            // 개발 로드맵
            const roadmap = data.development_roadmap;
            const timeline = roadmap.development_timeline;
            
            const developmentTimelineDiv = document.getElementById('developmentTimeline');
            developmentTimelineDiv.innerHTML = '';
            
            // 타임라인 항목 순서
            const timelineItems = [
                { key: 'pre_production', label: '사전 제작' },
                { key: 'prototype', label: '프로토타입' },
                { key: 'production', label: '본 제작' },
                { key: 'alpha', label: '알파' },
                { key: 'beta', label: '베타' },
                { key: 'gold', label: '골드 마스터' },
                { key: 'post_launch', label: '출시 후 지원' }
            ];
            
            timelineItems.forEach(item => {
                if (timeline[item.key]) {
                    const timelineItem = document.createElement('div');
                    timelineItem.className = 'mb-2';
                    timelineItem.innerHTML = `<strong>${item.label}:</strong> ${timeline[item.key]}`;
                    developmentTimelineDiv.appendChild(timelineItem);
                }
            });
            
            const team = roadmap.team_structure;
            
            const coreTeamList = document.getElementById('coreTeam');
            coreTeamList.innerHTML = '';
            team.core_team.forEach(role => {
                const li = document.createElement('li');
                li.textContent = role;
                coreTeamList.appendChild(li);
            });
            
            const expandedTeamList = document.getElementById('expandedTeam');
            expandedTeamList.innerHTML = '';
            team.expanded_team.forEach(role => {
                const li = document.createElement('li');
                li.textContent = role;
                expandedTeamList.appendChild(li);
            });
            
            document.getElementById('budgetEstimate').textContent = roadmap.budget_estimate;
            
            const riskAssessmentList = document.getElementById('riskAssessment');
            riskAssessmentList.innerHTML = '';
            roadmap.risk_assessment.forEach(risk => {
                const li = document.createElement('li');
                li.textContent = risk;
                riskAssessmentList.appendChild(li);
            });
            
            document.getElementById('testingPlan').textContent = roadmap.testing_plan;
            
            const successMetricsList = document.getElementById('successMetrics');
            successMetricsList.innerHTML = '';
            roadmap.success_metrics.forEach(metric => {
                const li = document.createElement('li');
                li.textContent = metric;
                successMetricsList.appendChild(li);
            });
            
            // 스토리라인 표시
            const storylineContent = document.getElementById('storylineContent');
            const storylineTab = document.getElementById('storyline-tab');

            if (data.storyline) {
                const storyline = data.storyline;
                
                // 스토리라인 컨텐츠 초기화
                storylineContent.innerHTML = '';
                
                // 스토리 제목 및 전제
                const titleSection = document.createElement('div');
                titleSection.className = 'result-section';
                titleSection.innerHTML = `
                    <h4 class="section-title">스토리 제목</h4>
                    <p>${storyline.title}</p>
                    
                    <h4 class="section-title">전제</h4>
                    <p>${storyline.premise}</p>
                    
                    <h4 class="section-title">스토리 아크</h4>
                    <p>${storyline.story_arc}</p>
                `;
                storylineContent.appendChild(titleSection);
                
                // 챕터 개요
                const chaptersSection = document.createElement('div');
                chaptersSection.className = 'result-section';
                chaptersSection.innerHTML = '<h4 class="section-title">챕터 개요</h4>';
                
                const chaptersAccordion = document.createElement('div');
                chaptersAccordion.className = 'accordion';
                chaptersAccordion.id = 'chaptersAccordion';
                
                storyline.chapter_outlines.forEach((chapter, index) => {
                    const chapterItem = document.createElement('div');
                    chapterItem.className = 'accordion-item';
                    
                    chapterItem.innerHTML = `
                        <h2 class="accordion-header" id="chapter-heading-${index}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#chapter-collapse-${index}" aria-expanded="false" aria-controls="chapter-collapse-${index}">
                                챕터 ${chapter.chapter_number}: ${chapter.title}
                            </button>
                        </h2>
                        <div id="chapter-collapse-${index}" class="accordion-collapse collapse" aria-labelledby="chapter-heading-${index}" data-bs-parent="#chaptersAccordion">
                            <div class="accordion-body">
                                <p><strong>개요:</strong> ${chapter.synopsis}</p>
                                
                                <h6>목표:</h6>
                                <ul>
                                    ${chapter.goals.map(goal => `<li>${goal}</li>`).join('')}
                                </ul>
                                
                                <h6>주요 위치:</h6>
                                <ul>
                                    ${chapter.key_locations.map(location => `<li>${location}</li>`).join('')}
                                </ul>
                                
                                <h6>주요 사건:</h6>
                                <ul>
                                    ${chapter.key_events.map(event => `<li>${event}</li>`).join('')}
                                </ul>
                                
                                <h6>도전 과제:</h6>
                                <ul>
                                    ${chapter.challenges.map(challenge => `<li>${challenge}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                    
                    chaptersAccordion.appendChild(chapterItem);
                });
                
                chaptersSection.appendChild(chaptersAccordion);
                storylineContent.appendChild(chaptersSection);
                
                // 스토리 분기
                if (storyline.story_branches && storyline.story_branches.story_branches) {
                    const branchesSection = document.createElement('div');
                    branchesSection.className = 'result-section';
                    branchesSection.innerHTML = '<h4 class="section-title">스토리 분기</h4>';
                    
                    const branchesAccordion = document.createElement('div');
                    branchesAccordion.className = 'accordion';
                    branchesAccordion.id = 'branchesAccordion';
                    
                    storyline.story_branches.story_branches.forEach((branch, index) => {
                        const branchItem = document.createElement('div');
                        branchItem.className = 'accordion-item';
                        
                        branchItem.innerHTML = `
                            <h2 class="accordion-header" id="branch-heading-${index}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#branch-collapse-${index}" aria-expanded="false" aria-controls="branch-collapse-${index}">
                                    ${branch.branch_name}
                                </button>
                            </h2>
                            <div id="branch-collapse-${index}" class="accordion-collapse collapse" aria-labelledby="branch-heading-${index}" data-bs-parent="#branchesAccordion">
                                <div class="accordion-body">
                                    <p><strong>트리거:</strong> ${branch.trigger}</p>
                                    <p><strong>시놉시스:</strong> ${branch.synopsis}</p>
                                    
                                    <h6>주요 사건:</h6>
                                    <ul>
                                        ${branch.key_events.map(event => `<li>${event}</li>`).join('')}
                                    </ul>
                                    
                                    <p><strong>결말:</strong> ${branch.ending}</p>
                                </div>
                            </div>
                        `;
                        
                        branchesAccordion.appendChild(branchItem);
                    });
                    
                    branchesSection.appendChild(branchesAccordion);
                    storylineContent.appendChild(branchesSection);
                }
                
                // 가능한 엔딩
                const endingsSection = document.createElement('div');
                endingsSection.className = 'result-section';
                endingsSection.innerHTML = `
                    <h4 class="section-title">가능한 엔딩</h4>
                    <ul>
                        ${storyline.possible_endings.map(ending => `<li>${ending}</li>`).join('')}
                    </ul>
                `;
                storylineContent.appendChild(endingsSection);
                
                // 스토리라인 탭 표시
                if (storylineTab) {
                    storylineTab.style.display = 'block';
                }
            } else {
                // 스토리라인이 없는 경우
                if (storylineContent) {
                    storylineContent.innerHTML = `
                        <div class="alert alert-info">
                            스토리라인을 생성하지 않았습니다. 스토리라인을 생성하려면 "스토리라인 함께 생성하기" 옵션을 체크한 후 다시 시도하세요.
                        </div>
                    `;
                }
                
                // 스토리라인 탭 숨기기
                if (storylineTab) {
                    storylineTab.style.display = 'none';
                }
            }
        }
    });
    </script>
</body>